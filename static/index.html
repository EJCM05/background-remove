<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Borrador de Fondo Avanzado</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Estilos para pantallas de 768px de ancho o menos (m√≥viles y tablets peque√±as) */
      @media (max-width: 768px) {
        /* Reduce el padding y margen del contenedor principal para dar m√°s espacio */
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
          margin-top: 2rem;
        }

        /* Reduce el tama√±o del t√≠tulo principal para que no se vea tan grande */
        h1 {
          font-size: 1.875rem; /* Equivalente a text-3xl de Tailwind */
          line-height: 2.25rem;
        }

        /* --- LA MAGIA EST√Å AQU√ç --- */
        /* 1. Permite que el contenedor de las herramientas se desplace horizontalmente */
        #editor-area {
          overflow-x: auto;
          /* Un peque√±o truco para que la barra de scroll no se pegue al borde */
          padding-bottom: 10px; 
        }

        /* 2. Fija un ancho m√≠nimo para el √°rea de trabajo para evitar que se encoja y distorsione */
        #canvas-container {
          min-width: 500px;
        }
        
        /* Hace que los botones de herramientas se apilen si no caben en una l√≠nea */
        .btn-group {
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .btn-group > .btn {
            flex-basis: 45%; /* Cada bot√≥n ocupa casi la mitad del espacio */
            flex-grow: 1;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <div class="container mx-auto mt-5 p-4 max-w-2xl">
      <header class="text-center mb-5">
        <h1 class="text-4xl font-bold mb-2">Borrador de Fondo</h1>
        <p class="text-gray-400">
          Sube una imagen y selecciona el √°rea que quieres conservar.
        </p>
      </header>

      <main>
        <div class="card bg-gray-800 border-gray-700 shadow-lg">
          <div class="card-body p-5">
            <form id="upload-form" class="space-y-4">
              <div>
                <label for="image-input" class="form-label font-semibold"
                  >1. Sube tu imagen:</label
                >
                <input
                  class="form-control bg-gray-700 border-gray-600 text-white"
                  type="file"
                  id="image-input"
                  accept="image/*"
                  required
                />
              </div>

              <div id="editor-area" class="hidden space-y-3">
                <div>
                  <label class="form-label font-semibold"
                    >2. Elige una herramienta y selecciona el √°rea a
                    conservar:</label
                  >
                  <div
                    class="btn-group w-full mb-3"
                    role="group"
                    aria-label="Herramientas de selecci√≥n"
                  >
                    <button
                      type="button"
                      id="tool-brush"
                      class="btn btn-primary tool-btn"
                    >
                      Pincel üñåÔ∏è
                    </button>
                    <button
                      type="button"
                      id="tool-eraser"
                      class="btn btn-outline-primary tool-btn"
                    >
                      Borrador ‚ú®
                    </button>
                    <button
                      type="button"
                      id="tool-rect"
                      class="btn btn-outline-primary tool-btn"
                    >
                      Rect√°ngulo ‚¨ú
                    </button>
                    <button
                      type="button"
                      id="tool-circle"
                      class="btn btn-outline-primary tool-btn"
                    >
                      C√≠rculo ‚ö™
                    </button>
                    <button
                      type="button"
                      id="tool-clear"
                      class="btn btn-outline-primary tool-btn"
                    > 
                    Borrar Todo
                    </button>
                </div>
                </div>

                <div>
                  <label for="brush-size" class="form-label font-semibold"
                    >Ajusta el tama√±o:</label
                  >
                  <div class="flex items-center space-x-3">
                    <span>Peque√±o</span>
                    <input
                      type="range"
                      class="form-range w-full"
                      min="5"
                      max="100"
                      value="20"
                      id="brush-size"
                    />
                    <span>Grande</span>
                  </div>
                </div>

                <div
                  id="canvas-container"
                  class="w-full max-w-full mx-auto bg-gray-900 rounded-lg relative overflow-hidden"
                >
                  <canvas
                    id="image-canvas"
                    class="absolute top-0 left-0 w-full h-full"
                  ></canvas>
                  <canvas
                    id="mask-canvas"
                    class="absolute top-0 left-0 w-full h-full"
                  ></canvas>
                  <canvas
                    id="preview-canvas"
                    class="cursor-crosshair absolute top-0 left-0 w-full h-full"
                  ></canvas>
                </div>
              </div>

              <button
                type="submit"
                id="submit-button"
                class="w-full btn btn-primary font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"
              >
                <span id="button-text">Eliminar Fondo</span>
                <div
                  id="spinner"
                  class="spinner-border spinner-border-sm text-light d-none"
                  role="status"
                >
                  <span class="visually-hidden">Procesando...</span>
                </div>
              </button>
            </form>
          </div>
        </div>

        <div id="result-area" class="mt-5 text-center hidden">
          <h2 class="text-2xl font-semibold mb-3">¬°Aqu√≠ est√° tu imagen!</h2>
          <div class="bg-gray-800 border-gray-700 rounded-lg p-4 inline-block">
            <div
              class="bg-light"
              style="
                background-image: repeating-conic-gradient(
                  #808080 0% 25%,
                  transparent 0% 50%
                );
                background-size: 20px 20px;
              "
            >
              <img
                id="result-image"
                src=""
                alt="Imagen procesada"
                class="max-w-full h-auto rounded relative"
                style="max-height: 70vh"
              />
            </div>
          </div>
          <a
            id="download-link"
            href="#"
            class="btn btn-success mt-4 inline-block"
            download="imagen-sin-fondo.png"
          >
            Descargar Imagen
          </a>
        </div>
      </main>

      <footer class="text-center text-gray-500 mt-10 mb-4">
        &copy; 2024 Borrador de Fondo EJCM - HOAT. Todos los derechos reservados.
      </footer>
    </div>

    <script src="/static/script.js"></script>
  </body>
</html>